{% extends "base.html" %}
{% block content %}

<h3 style="text-align:center;">Upload Your Image</h3>

<form id="uploadForm" enctype="multipart/form-data" style="text-align:center; margin-top:20px;">
    <input type="file" name="file" accept="image/*" required>
    <br><br>
    <button type="submit">Predict</button>
    <button type="button" onclick="clearForm()">Clear</button>
</form>

<div id="loading" style="display:none; text-align:center; margin-top:20px;">
  <div class="spinner"></div>
  <p>Model is predicting... please wait</p>
</div>

<div id="preview" style="text-align:center; margin-top:20px;"></div>
<div id="result" class="result-box" style="display:none; text-align:center; margin-top:20px;"></div>

<script>
const form = document.getElementById("uploadForm");
const loading = document.getElementById("loading");
const preview = document.getElementById("preview");
const result = document.getElementById("result");

form.addEventListener("submit", function(e){
    e.preventDefault();
    const formData = new FormData(form);

    loading.style.display = "block";
    result.style.display = "none";
    preview.innerHTML = "";

    fetch("/predict", { method: "POST", body: formData })
    .then(res => res.json())
    .then(data => {
        loading.style.display = "none";

        if(data.error){
            result.style.display = "block";
            result.innerHTML = `<p style="color:red;">${data.error}</p>`;
        } else {
            preview.innerHTML = `<img src="/${data.file_path}" width="300" style="border-radius:10px;">`;
            result.style.display = "block";
            result.innerHTML = `<h4>Prediction:</h4><p>${data.prediction}</p>`;
        }
    });
});

function clearForm(){
    form.reset();
    preview.innerHTML = "";
    result.style.display = "none";
}
</script>

{% endblock %}
